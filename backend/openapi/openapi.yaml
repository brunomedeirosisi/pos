openapi: 3.0.3
info:
  title: POS Platform API
  version: 0.1.0
  description: >
    REST API for the POS platform providing checkout, backoffice, and
    synchronization capabilities. The API is designed to be idempotent, secure,
    and ready for hybrid deployments.
servers:
  - url: http://localhost:8080
    description: Local development
tags:
  - name: Health
  - name: Auth
  - name: Catalog
  - name: Customers
  - name: Sales
  - name: Administration
security:
  - bearerAuth: []
paths:
  /api/v1/health:
    get:
      tags:
        - Health
      security: []
      summary: Health probe
      description: Returns basic service availability metadata.
      responses:
        '200':
          description: Service is healthy.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  time:
                    type: string
                    format: date-time
                required:
                  - status
                  - time
  /api/v1/auth/login:
    post:
      tags:
        - Auth
      summary: Authenticate user
      description: Exchanges user credentials for a JWT bearer token.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Authentication succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  /api/v1/auth/me:
    get:
      tags:
        - Auth
      summary: Return authenticated user
      description: Returns details about the currently authenticated user.
      responses:
        '200':
          description: Authenticated user details.
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/AuthenticatedUser'
                required:
                  - user
        '401':
          $ref: '#/components/responses/UnauthorizedError'
  /api/v1/product-groups:
    get:
      tags:
        - Catalog
      summary: List product groups
      parameters:
        - $ref: '#/components/parameters/SearchQuery'
        - $ref: '#/components/parameters/LimitQuery'
      responses:
        '200':
          description: Product groups ordered by name.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProductGroup'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    post:
      tags:
        - Catalog
      summary: Create product group
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductGroupWrite'
      responses:
        '201':
          description: Product group created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductGroup'
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          $ref: '#/components/responses/ConflictError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /api/v1/product-groups/{id}:
    get:
      tags:
        - Catalog
      summary: Get product group
      parameters:
        - $ref: '#/components/parameters/ResourceId'
      responses:
        '200':
          description: Product group.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductGroup'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    patch:
      tags:
        - Catalog
      summary: Update product group
      parameters:
        - $ref: '#/components/parameters/ResourceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductGroupPatch'
      responses:
        '200':
          description: Product group updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductGroup'
        '204':
          description: No fields changed.
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /api/v1/products:
    get:
      tags:
        - Catalog
      summary: List products
      parameters:
        - $ref: '#/components/parameters/SearchQuery'
        - $ref: '#/components/parameters/LimitQuery'
      responses:
        '200':
          description: Products ordered by name.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    post:
      tags:
        - Catalog
      summary: Create product
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductWrite'
      responses:
        '201':
          description: Product created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          $ref: '#/components/responses/ConflictError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /api/v1/products/{id}:
    get:
      tags:
        - Catalog
      summary: Get product
      parameters:
        - $ref: '#/components/parameters/ResourceId'
      responses:
        '200':
          description: Product.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    patch:
      tags:
        - Catalog
      summary: Update product
      parameters:
        - $ref: '#/components/parameters/ResourceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductPatch'
      responses:
        '200':
          description: Product updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '204':
          description: No fields changed.
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /api/v1/customers:
    get:
      tags:
        - Customers
      summary: List customers
      parameters:
        - $ref: '#/components/parameters/SearchQuery'
        - $ref: '#/components/parameters/LimitQuery'
      responses:
        '200':
          description: Customers ordered by name.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Customer'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    post:
      tags:
        - Customers
      summary: Create customer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerWrite'
      responses:
        '201':
          description: Customer created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Customer'
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          $ref: '#/components/responses/ConflictError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /api/v1/customers/{id}:
    get:
      tags:
        - Customers
      summary: Get customer
      parameters:
        - $ref: '#/components/parameters/ResourceId'
      responses:
        '200':
          description: Customer.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Customer'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    patch:
      tags:
        - Customers
      summary: Update customer
      parameters:
        - $ref: '#/components/parameters/ResourceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerPatch'
      responses:
        '200':
          description: Customer updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Customer'
        '204':
          description: No fields changed.
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /api/v1/sellers:
    get:
      tags:
        - Catalog
      summary: List sellers
      parameters:
        - $ref: '#/components/parameters/SearchQuery'
        - $ref: '#/components/parameters/LimitQuery'
      responses:
        '200':
          description: Sellers ordered by name.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Seller'
    post:
      tags:
        - Catalog
      summary: Create seller
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SellerWrite'
      responses:
        '201':
          description: Seller created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Seller'
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          $ref: '#/components/responses/ConflictError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /api/v1/sellers/{id}:
    get:
      tags:
        - Catalog
      summary: Get seller
      parameters:
        - $ref: '#/components/parameters/ResourceId'
      responses:
        '200':
          description: Seller.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Seller'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    patch:
      tags:
        - Catalog
      summary: Update seller
      parameters:
        - $ref: '#/components/parameters/ResourceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SellerPatch'
      responses:
        '200':
          description: Seller updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Seller'
        '204':
          description: No fields changed.
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /api/v1/payment-terms:
    get:
      tags:
        - Catalog
      summary: List payment terms
      parameters:
        - $ref: '#/components/parameters/SearchQuery'
        - $ref: '#/components/parameters/LimitQuery'
      responses:
        '200':
          description: Payment terms ordered by name.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PaymentTerm'
    post:
      tags:
        - Catalog
      summary: Create payment term
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentTermWrite'
      responses:
        '201':
          description: Payment term created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentTerm'
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          $ref: '#/components/responses/ConflictError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /api/v1/payment-terms/{id}:
    get:
      tags:
        - Catalog
      summary: Get payment term
      parameters:
        - $ref: '#/components/parameters/ResourceId'
      responses:
        '200':
          description: Payment term.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentTerm'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    patch:
      tags:
        - Catalog
      summary: Update payment term
      parameters:
        - $ref: '#/components/parameters/ResourceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentTermPatch'
      responses:
        '200':
          description: Payment term updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentTerm'
        '204':
          description: No fields changed.
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /api/v1/sales:
    get:
      tags:
        - Sales
      summary: List sales
      parameters:
        - name: from
          in: query
          description: Filter by emission date (inclusive, YYYY-MM-DD).
          schema:
            type: string
            format: date
        - name: to
          in: query
          description: Filter by emission date (inclusive, YYYY-MM-DD).
          schema:
            type: string
            format: date
        - name: seller_id
          in: query
          description: Filter by seller identifier.
          schema:
            type: string
            format: uuid
        - name: customer_id
          in: query
          description: Filter by customer identifier.
          schema:
            type: string
            format: uuid
        - name: payment_term_id
          in: query
          description: Filter by payment term identifier.
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          description: Maximum number of records to return (default 100, max 200).
          schema:
            type: integer
            minimum: 1
            maximum: 200
      responses:
        '200':
          description: Most recent sales first.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Sale'
    post:
      tags:
        - Sales
      summary: Register sale
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaleCreate'
      responses:
        '201':
          description: Sale created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Sale'
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          $ref: '#/components/responses/ConflictError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /api/v1/sales/{id}:
    get:
      tags:
        - Sales
      summary: Get sale
      parameters:
        - $ref: '#/components/parameters/ResourceId'
      responses:
        '200':
          description: Sale with items.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Sale'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /api/v1/sales/{id}/cancel:
    post:
      tags:
        - Sales
      summary: Cancel sale
      description: >
        Cancels a sale when permitted by RBAC policy. Previously cancelled sales
        return 404 to prevent idempotency violations.
      parameters:
        - $ref: '#/components/parameters/ResourceId'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaleCancel'
      responses:
        '200':
          description: Sale cancelled.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Sale'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /api/v1/users:
    get:
      tags:
        - Administration
      summary: List users
      parameters:
        - $ref: '#/components/parameters/SearchQuery'
      responses:
        '200':
          description: Application users ordered by full name.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    post:
      tags:
        - Administration
      summary: Create user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreate'
      responses:
        '201':
          description: Created user.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '409':
          $ref: '#/components/responses/ConflictError'
  /api/v1/users/{id}:
    get:
      tags:
        - Administration
      summary: Get user
      parameters:
        - $ref: '#/components/parameters/ResourceId'
      responses:
        '200':
          description: User details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    patch:
      tags:
        - Administration
      summary: Update user
      parameters:
        - $ref: '#/components/parameters/ResourceId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdate'
      responses:
        '200':
          description: Updated user.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '409':
          $ref: '#/components/responses/ConflictError'
    delete:
      tags:
        - Administration
      summary: Disable user
      parameters:
        - $ref: '#/components/parameters/ResourceId'
      responses:
        '204':
          description: User disabled.
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
  /api/v1/roles:
    get:
      tags:
        - Administration
      summary: List roles
      responses:
        '200':
          description: Available roles ordered by name.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Role'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    post:
      tags:
        - Administration
      summary: Create role
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleCreate'
      responses:
        '201':
          description: Created role.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '409':
          $ref: '#/components/responses/ConflictError'
  /api/v1/roles/{id}:
    get:
      tags:
        - Administration
      summary: Get role
      parameters:
        - $ref: '#/components/parameters/ResourceId'
      responses:
        '200':
          description: Role details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
  /api/v1/admin/backups:
    get:
      tags:
        - Administration
      summary: List backups
      responses:
        '200':
          description: Available system backups.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SystemBackup'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /api/v1/admin/backup:
    post:
      tags:
        - Administration
      summary: Create backup
      description: Triggers a full database backup and registers the archive.
      responses:
        '201':
          description: Backup created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemBackup'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /api/v1/admin/backup/upload:
    post:
      tags:
        - Administration
      summary: Upload backup archive
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: Backup archive (.zip)
              required:
                - file
      responses:
        '201':
          description: Backup uploaded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemBackup'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /api/v1/admin/backup/{filename}:
    delete:
      tags:
        - Administration
      summary: Delete backup
      parameters:
        - $ref: '#/components/parameters/BackupFilename'
      responses:
        '204':
          description: Backup removed.
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
  /api/v1/admin/backup/{filename}/download:
    get:
      tags:
        - Administration
      summary: Download backup archive
      parameters:
        - $ref: '#/components/parameters/BackupFilename'
      responses:
        '200':
          description: Backup archive.
          content:
            application/zip:
              schema:
                type: string
                format: binary
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
  /api/v1/admin/restore:
    post:
      tags:
        - Administration
      summary: Restore backup
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RestoreRequest'
      responses:
        '200':
          description: Restore accepted.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestoreResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
  /api/v1/admin/import/legacy:
    post:
      tags:
        - Administration
      summary: Import legacy DBF data
      description: >
        Uploads legacy DBF/DBT files (or a ZIP archive) and queues the ETL pipeline
        to rebuild the normalized database from legacy staging tables.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/LegacyImportRequest'
      responses:
        '202':
          description: Import accepted.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LegacyImportResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /api/v1/admin/import/legacy/{sessionId}/status:
    get:
      tags:
        - Administration
      summary: Get legacy import status
      parameters:
        - $ref: '#/components/parameters/ImportSessionId'
      responses:
        '200':
          description: Current status for the legacy import.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LegacyImportStatus'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
  /api/v1/admin/import/legacy/{sessionId}/report:
    get:
      tags:
        - Administration
      summary: Download legacy import reconciliation report
      parameters:
        - $ref: '#/components/parameters/ImportSessionId'
      responses:
        '200':
          description: CSV reconciliation report.
          content:
            text/csv:
              schema:
                type: string
                format: binary
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
components:
  parameters:
    ResourceId:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
    BackupFilename:
      name: filename
      in: path
      required: true
      description: Backup archive filename.
      schema:
        type: string
    ImportSessionId:
      name: sessionId
      in: path
      required: true
      description: Import session identifier.
      schema:
        type: string
    SearchQuery:
      name: search
      in: query
      description: Case insensitive partial match on name, legacy code, or identifier.
      schema:
        type: string
    LimitQuery:
      name: limit
      in: query
      description: Maximum number of records to return (default 100, max 500).
      schema:
        type: integer
        minimum: 1
        maximum: 500
  responses:
    ValidationError:
      description: Request payload failed validation.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationError'
    NotFoundError:
      description: Resource not found.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            default:
              value:
                message: resource not found
    ConflictError:
      description: Unique constraint violation.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            default:
              value:
                message: conflict
    UnauthorizedError:
      description: Authentication credentials are missing or invalid.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            default:
              value:
                message: unauthorized
    ForbiddenError:
      description: Authenticated user lacks permission for the requested action.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            default:
              value:
                message: forbidden
  schemas:
    ProductGroup:
      type: object
      properties:
        id:
          type: string
          format: uuid
        legacy_code:
          type: string
          nullable: true
        name:
          type: string
      required:
        - id
        - name
    ProductGroupWrite:
      type: object
      properties:
        legacy_code:
          type: string
          nullable: true
        name:
          type: string
      required:
        - name
    ProductGroupPatch:
      allOf:
        - $ref: '#/components/schemas/ProductGroupWrite'
    Product:
      type: object
      properties:
        id:
          type: string
          format: uuid
        legacy_code:
          type: string
          nullable: true
        name:
          type: string
        barcode:
          type: string
          nullable: true
        group_id:
          type: string
          format: uuid
          nullable: true
        reference:
          type: string
          nullable: true
        min_stock:
          type: number
          format: float
          nullable: true
        price_cash:
          type: number
          format: float
          nullable: true
        price_base:
          type: number
          format: float
          nullable: true
      required:
        - id
        - name
    ProductWrite:
      type: object
      properties:
        legacy_code:
          type: string
          nullable: true
        name:
          type: string
        barcode:
          type: string
          nullable: true
        group_id:
          type: string
          format: uuid
          nullable: true
        reference:
          type: string
          nullable: true
        min_stock:
          type: number
          format: float
          nullable: true
        price_cash:
          type: number
          format: float
          nullable: true
        price_base:
          type: number
          format: float
          nullable: true
      required:
        - name
    ProductPatch:
      allOf:
        - $ref: '#/components/schemas/ProductWrite'
    Customer:
      type: object
      properties:
        id:
          type: string
          format: uuid
        legacy_code:
          type: string
          nullable: true
        name:
          type: string
        cpf:
          type: string
          nullable: true
        address:
          type: string
          nullable: true
        city:
          type: string
          nullable: true
        uf:
          type: string
          nullable: true
        cep:
          type: string
          nullable: true
        phone:
          type: string
          nullable: true
        status:
          type: string
          enum:
            - active
            - delinquent
            - inactive
        credit_limit:
          type: number
          format: float
          nullable: true
        notes:
          type: string
          nullable: true
      required:
        - id
        - name
        - status
    CustomerWrite:
      type: object
      properties:
        legacy_code:
          type: string
          nullable: true
        name:
          type: string
        cpf:
          type: string
          nullable: true
        address:
          type: string
          nullable: true
        city:
          type: string
          nullable: true
        uf:
          type: string
          nullable: true
          minLength: 2
          maxLength: 2
        cep:
          type: string
          nullable: true
        phone:
          type: string
          nullable: true
        status:
          type: string
          enum:
            - active
            - delinquent
            - inactive
          default: active
        credit_limit:
          type: number
          format: float
          nullable: true
        notes:
          type: string
          nullable: true
      required:
        - name
    CustomerPatch:
      allOf:
        - $ref: '#/components/schemas/CustomerWrite'
    Seller:
      type: object
      properties:
        id:
          type: string
          format: uuid
        legacy_code:
          type: string
          nullable: true
        name:
          type: string
      required:
        - id
        - name
    SellerWrite:
      type: object
      properties:
        legacy_code:
          type: string
          nullable: true
        name:
          type: string
      required:
        - name
    SellerPatch:
      allOf:
        - $ref: '#/components/schemas/SellerWrite'
    PaymentTerm:
      type: object
      properties:
        id:
          type: string
          format: uuid
        legacy_code:
          type: string
          nullable: true
        name:
          type: string
      required:
        - id
        - name
    PaymentTermWrite:
      type: object
      properties:
        legacy_code:
          type: string
          nullable: true
        name:
          type: string
      required:
        - name
    PaymentTermPatch:
      allOf:
        - $ref: '#/components/schemas/PaymentTermWrite'
    SaleItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        product_id:
          type: string
          format: uuid
        quantity:
          type: number
          format: float
        unit_price:
          type: number
          format: float
        total:
          type: number
          format: float
      required:
        - id
        - product_id
        - quantity
        - unit_price
        - total
    Sale:
      type: object
      properties:
        id:
          type: string
          format: uuid
        emission_date:
          type: string
          format: date
        order_number:
          type: string
          nullable: true
        seller_id:
          type: string
          format: uuid
          nullable: true
        customer_id:
          type: string
          format: uuid
          nullable: true
        payment_term_id:
          type: string
          format: uuid
          nullable: true
        subtotal:
          type: number
          format: float
        discount:
          type: number
          format: float
        total:
          type: number
          format: float
        status:
          type: string
          enum:
            - draft
            - completed
            - cancelled
        source:
          type: string
          nullable: true
        source_key:
          type: string
          nullable: true
        cancelled_at:
          type: string
          format: date-time
          nullable: true
        cancellation_reason:
          type: string
          nullable: true
        items:
          type: array
          items:
            $ref: '#/components/schemas/SaleItem'
      required:
        - id
        - emission_date
        - subtotal
        - discount
        - total
        - status
        - items
    SaleItemWrite:
      type: object
      properties:
        product_id:
          type: string
          format: uuid
        quantity:
          type: number
          format: float
          minimum: 0
        unit_price:
          type: number
          format: float
          minimum: 0
        total:
          type: number
          format: float
          nullable: true
      required:
        - product_id
        - quantity
        - unit_price
    SaleCreate:
      type: object
      properties:
        emission_date:
          type: string
          format: date
        order_number:
          type: string
          nullable: true
        seller_id:
          type: string
          format: uuid
          nullable: true
        customer_id:
          type: string
          format: uuid
          nullable: true
        payment_term_id:
          type: string
          format: uuid
          nullable: true
        subtotal:
          type: number
          format: float
          nullable: true
        discount:
          type: number
          format: float
          nullable: true
        total:
          type: number
          format: float
          nullable: true
        source:
          type: string
          nullable: true
        source_key:
          type: string
          nullable: true
        items:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/SaleItemWrite'
      required:
        - items
    SaleCancel:
      type: object
      properties:
        reason:
          type: string
          nullable: true
    LoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
      required:
        - email
        - password
    Role:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
          nullable: true
        permissions:
          type: array
          items:
            type: string
        discountLimit:
          type: number
          format: float
      required:
        - id
        - name
        - permissions
        - discountLimit
    RoleCreate:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
          nullable: true
        permissions:
          type: array
          items:
            type: string
        discountLimit:
          type: number
          format: float
          nullable: true
      required:
        - name
        - permissions
    RoleUpdate:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
          nullable: true
        permissions:
          type: array
          items:
            type: string
        discountLimit:
          type: number
          format: float
          nullable: true
      minProperties: 1
    UserRoleSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        permissions:
          type: array
          items:
            type: string
        discountLimit:
          type: number
          format: float
      required:
        - id
        - name
        - permissions
        - discountLimit
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        fullName:
          type: string
        status:
          type: string
          enum:
            - active
            - disabled
        lastLoginAt:
          type: string
          format: date-time
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        role:
          $ref: '#/components/schemas/UserRoleSummary'
          nullable: true
        permissions:
          type: array
          items:
            type: string
      required:
        - id
        - email
        - fullName
        - status
        - createdAt
        - updatedAt
        - permissions
    UserCreate:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
          minLength: 8
        fullName:
          type: string
        roleId:
          type: string
          format: uuid
        status:
          type: string
          enum:
            - active
            - disabled
      required:
        - email
        - password
        - fullName
        - roleId
    UserUpdate:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
          minLength: 8
        fullName:
          type: string
        roleId:
          type: string
          format: uuid
        status:
          type: string
          enum:
            - active
            - disabled
      minProperties: 1
    SystemBackup:
      type: object
      properties:
        id:
          type: string
          format: uuid
        filename:
          type: string
        sizeBytes:
          type: integer
          format: int64
        createdAt:
          type: string
          format: date-time
        checksum:
          type: string
          nullable: true
        metadata:
          type: object
          nullable: true
          additionalProperties: true
        createdBy:
          type: object
          nullable: true
          properties:
            id:
              type: string
              format: uuid
            fullName:
              type: string
          required:
            - id
            - fullName
      required:
        - id
        - filename
        - sizeBytes
        - createdAt
    RestoreRequest:
      type: object
      properties:
        file:
          type: string
        password:
          type: string
        confirm:
          type: boolean
          description: Confirmation flag. Must be true.
      required:
        - file
        - password
        - confirm
    RestoreResponse:
      type: object
      properties:
        status:
          type: string
        restored:
          type: boolean
      required:
        - status
        - restored
    LegacyImportRequest:
      type: object
      properties:
        files:
          type: array
          items:
            type: string
            format: binary
        overwrite:
          type: boolean
          default: false
        password:
          type: string
        confirmation:
          type: string
      required:
        - files
        - password
        - confirmation
    LegacyImportResponse:
      type: object
      properties:
        status:
          type: string
        sessionId:
          type: string
        importId:
          type: string
          format: uuid
        overwrite:
          type: boolean
        files:
          type: array
          items:
            type: string
        message:
          type: string
      required:
        - status
        - sessionId
        - overwrite
        - files
        - message
    LegacyImportLogEntry:
      type: object
      properties:
        level:
          type: string
        message:
          type: string
        createdAt:
          type: string
          format: date-time
      required:
        - level
        - message
        - createdAt
    LegacyImportStatus:
      type: object
      properties:
        status:
          type: string
        overwrite:
          type: boolean
        createdAt:
          type: string
          format: date-time
        startedAt:
          type: string
          format: date-time
          nullable: true
        finishedAt:
          type: string
          format: date-time
          nullable: true
        summary:
          type: object
          nullable: true
        error:
          type: string
          nullable: true
        reportAvailable:
          type: boolean
        logs:
          type: array
          items:
            $ref: '#/components/schemas/LegacyImportLogEntry'
      required:
        - status
        - overwrite
        - createdAt
        - reportAvailable
        - logs
    AuthenticatedUser:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        fullName:
          type: string
        role:
          type: string
        permissions:
          type: array
          items:
            type: string
        discountLimit:
          type: number
          format: float
      required:
        - id
        - email
        - fullName
        - role
        - permissions
        - discountLimit
    LoginResponse:
      type: object
      properties:
        token:
          type: string
        user:
          $ref: '#/components/schemas/AuthenticatedUser'
      required:
        - token
        - user
    ErrorResponse:
      type: object
      properties:
        message:
          type: string
        details:
          nullable: true
      required:
        - message
    ValidationError:
      type: object
      properties:
        message:
          type: string
          example: validation_failed
        issues:
          type: array
          items:
            type: object
            properties:
              path:
                type: array
                items:
                  type: string
              message:
                type: string
              code:
                type: string
            required:
              - path
              - message
              - code
      required:
        - message
        - issues
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
